# RLC-510A プロジェクト技術仕様書 - ClaudeCode引き継ぎ用

## プロジェクト概要

**目的**: RLC-510AセキュリティカメラからPythonを使用して映像データと各種情報を取得するシステム開発

## ハードウェア仕様（確定情報）

### **基本仕様**
- **製品名**: Reolink RLC-510A
- **ハードウェアバージョン**: IPC_MS1NA45MP（V1確定）
- **UID**: 9527000ILDMY6HAQ
- **解像度**: 2560 x 1920ピクセル（5MP）
- **センサー**: 1/2.7インチCMOS
- **視野角**: 80°（水平）
- **暗視機能**: 100フィート（18個IR LED）
- **電源**: PoE（IEEE 802.3af、12W）
- **防水性能**: IP66

### **現在のファームウェア情報**
- **バージョン**: v3.0.0.4348_2411261176
- **ビルド**: 2411261176
- **リリース日**: 2024年11月26日（確認済み）
- **状況**: ✅ **動作確認済み** - Phase 2実装機能との完全互換性確認

### **動作確認結果**
- **API接続**: ✅ 完全対応（認証・情報取得・設定変更）
- **RTSPストリーム**: ✅ 安定動作（14.5fps平均、フレームドロップ率19%）
- **映像品質**: ✅ 良好（メイン 2560×1920@30fps、サブ 640×480@15fps）
- **推奨度**: 🌟 本プロジェクトでの使用に最適

## ネットワーク構成

### **カメラ側**
- **接続方式**: PoE（有線）
- **IPアドレス**: 192.168.31.85
- **サブネット**: 255.255.255.0
- **ゲートウェイ**: 192.168.31.1
- **MACアドレス**: ec:71:db:f6:92:20

### **PC側**
- **接続方式**: WiFi（無線）
- **特記事項**: Tailscaleインストール済み
- **注意点**: ローカルネットワークアクセス設定要確認

### **ネットワーク互換性**
- ✅ PoE（カメラ）× WiFi（PC）構成は動作可能
- ⚠️ Tailscaleによるローカルルーティング影響に注意
- 📝 直接IPアドレス指定（192.168.31.85）推奨

## Python開発環境

### **推奨ライブラリ**
- **reolinkapipy**: 公式API対応、最も包括的
- **OpenCV**: RTSP映像処理用
- **requests**: HTTP API直接アクセス用

### **接続プロトコル**
1. **Reolink独自API**: HTTP/HTTPS（ポート80/443）
2. **RTSP**: リアルタイム映像（ポート554）
3. **ONVIF**: 標準プロトコル（ポート8000）- 制限あり

## 取得可能データ一覧

### **映像・画像関連**
- ライブストリーミング映像（RTSP）
- 複数解像度ストリーム（メイン/サブ/スナップショット）
- 静止画スナップショット
- 録画ファイルアクセス（microSD/NVR/FTP）

### **AI検知・イベント情報**
- 人間検知イベント（座標、信頼度、タイムスタンプ）
- 車両検知イベント
- 動物検知イベント
- 一般モーション検知
- 検知ゾーン設定情報
- イベント履歴

### **デバイス状態・設定**
- ✅ **デバイス情報**: モデル名 (RLC-510A)、ファームウェア、シリアル番号
- ✅ **ネットワーク設定**: IP、MAC、DHCP状態、DNS設定  
- ✅ **エンコード設定**: 解像度、フレームレート、ビットレート、コーデック
- ✅ **OSD設定**: 画面表示情報（時刻、チャンネル名、透かし）
- ⚠️ **ストレージ情報**: HDD情報（基本API対応、詳細情報要調査）

### **音声・制御情報**
- 音声録音データ
- 音量レベル測定
- PTZ制御情報（該当する場合）
- アラーム・通知設定

## 技術的制約・注意点

### **Reolinkエコシステム制約**
- ✅ Reolink純正環境では全機能利用可能
- ⚠️ Blue Iris等サードパーティNVRとの互換性制限
- ⚠️ ONVIF対応は基本機能のみ

### **同時接続制限**
- 最大接続数: 20ユーザー（1管理者 + 19一般）
- 同時動画ストリーム: 12本（メイン2 + サブ10）
- 競合回避: 他のNVRソフトとの同時使用に注意

### **ファームウェア依存性**
- ✅ **V1ハードウェア**: IPC_MS1NA45MP 完全対応確認済み
- ✅ **現在バージョン**: v3.0.0.4348_2411261176 検証完了
- ✅ **API互換性**: reolinkapi v0.1.5 との完全互換性確認
- 📝 **推奨**: 現在のファームウェアバージョンでの運用を推奨

## 開発推奨アプローチ

### **Phase 1: 環境確認**
```python
# 接続テスト
camera_ip = "192.168.31.85"
# Tailscale環境でのローカルアクセス確認
# reolinkapipy基本接続テスト
```

### **Phase 2: 基本機能実装** ✅ **完了**
- ✅ **デバイス情報取得**: get_information(), get_general_system() 実装完了
- ✅ **ライブ映像ストリーミング**: RTSPStream クラス（14.5fps安定動作）
- ✅ **映像表示・録画**: OpenCV表示、MP4録画、セグメント分割対応
- ✅ **スナップショット取得**: RTSP/API両方式対応
- ✅ **イベント監視**: 基本的なモーション検知フレームワーク

### **Phase 3: 高度機能実装**
- AI検知イベント取得
- リアルタイム通知処理
- 映像解析との連携
- 設定変更・制御機能

### **Phase 4: 安定性向上**
- 長時間動作テスト
- エラーハンドリング強化
- 接続復旧機能
- ログ・監視機能

## セキュリティ考慮事項

### **認証**
- デフォルト: admin/[設定パスワード]
- HTTPS使用推奨
- 定期的なパスワード変更

### **ネットワーク**
- ローカルネットワーク内運用推奨
- ファイアウォール設定確認
- Tailscale使用時のルーティング確認

## トラブルシューティング情報

### **よくある問題**
1. **接続不可**: IPアドレス・認証情報確認
2. **映像途切れ**: ネットワーク帯域・同時接続数確認
3. **API応答なし**: ファームウェアバージョン・ポート設定確認
4. **Tailscale干渉**: ローカルルーティング設定確認

### **デバッグ用コマンド**
```bash
# 基本接続確認
ping 192.168.31.85
telnet 192.168.31.85 80    # HTTP
telnet 192.168.31.85 554   # RTSP
telnet 192.168.31.85 8000  # ONVIF

# ネットワーク確認
nmap -p 80,443,554,8000,9000 192.168.31.85
```

## 開発優先度

### **高優先度**
1. reolinkapipy接続確立
2. ライブ映像取得（RTSP）
3. 基本的なデバイス情報取得

### **中優先度**
1. AI検知イベント取得
2. スナップショット機能
3. 設定変更機能

### **低優先度**
1. 録画ファイルアクセス
2. 音声機能
3. ONVIF互換性

## 開発状況と次のアクション

### **Phase 1 & 2 完了状況** ✅
1. ✅ **環境セットアップ**: conda環境 + reolinkapi v0.1.5
2. ✅ **基本接続確認**: API認証・RTSPストリーム動作確認済み
3. ✅ **コア機能実装**: 映像表示・録画・スナップショット・イベント監視
4. ✅ **エラーハンドリング**: 自動再接続・タイムアウト・ログ機能
5. ✅ **デモアプリケーション**: 総合デモ・個別機能デモ完備

### **動作確認済み機能**
- **RTSPストリーミング**: 14.5fps安定動作、640×480@15fps
- **API通信**: デバイス情報・ネットワーク設定・エンコード設定取得
- **映像処理**: OpenCVリアルタイム表示・MP4録画・JPEG撮影
- **システム統合**: 設定管理・ログ記録・統計情報

### **次のステップ（Phase 3）**
1. **AI検知機能強化**: 人間・車両・動物検知イベントの詳細取得
2. **リアルタイム通知**: Webhook・メール・プッシュ通知
3. **Web UIポータル**: ブラウザベース操作画面
4. **高度な映像解析**: 物体追跡・顔認識・行動解析

### **使用方法**
```bash
# 環境アクティベート
source ~/anaconda3/bin/activate hamcam

# 総合デモ実行
python examples/comprehensive_demo.py

# 個別機能テスト  
python video_viewer.py -s sub        # ライブ表示
python snapshot.py -m rtsp -s main   # スナップショット
python video_recorder.py -d 60       # 録画
```

**本システムはPhase 2完了により実用レベルに到達しました。** 🎉